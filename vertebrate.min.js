/**
* Vertebrate.js 0.2.0
* https://github.com/psalmody/vertebratejs
*/
!function(){return"undefined"==typeof $?(console.log("%cError:","color:red;font-weight:bold","Vertebrate.js requires jQuery 1.11+"),!1):(Vertebrate={settings:{},get:function(t){return"undefined"==typeof t?this.settings:this.settings[t]},set:function(t,e){return this.settings[t]=e},shared:{fn:function(){this.attributes={},this.changedattrs=[],this.set=function(t,e){return this.attributes[t]=e,this.changedattrs.push(t),$(document).trigger("vertebrate:changeattr",[this,this.attributes,this.changedattrs]),!0},this.get=function(t){return"undefined"==typeof t?this.attributes:this.attributes[t]},this.has=function(t){return"undefined"==typeof this.attributes[t]?!1:!0},this.hasChanged=function(t){var t="undefined"==typeof t?!1:t;return t?this.changedattrs.indexOf(t)>=0?!0:!1:this.changedattrs.length>0?!0:!1}}}},Vertebrate.Model=function(t){var e=this;Vertebrate.shared.fn.call(this);var t="undefined"==typeof t?!1:t;t&&$.each(t,function(t,r){e[t]="object"==typeof r?$.extend(e[t],r):r}),this.save=function(t){var r=$.ajax({url:"undefined"==typeof this.url?Vertebrate.get("url"):this.url,method:"POST",data:{data:JSON.stringify(this.get())},success:function(r,n,o){e.changedattrs=[],"function"==typeof t&&t.call(e,r,n,o)}});return r},this.fetch=function(t){var r=$.ajax({url:"undefined"==typeof this.url?Vertebrate.get("url"):this.url,method:"GET",data:this.get(),success:function(r,n,o){e.changedattrs=[],e.attributes=$.extend(e.attributes,r[0]),"function"==typeof t&&t.call(e,r,n,o)}});return r},this.delete=function(t){var r=$.ajax({url:"undefined"==typeof this.url?Vertebrate.get("url"):this.url,method:"DELETE",data:JSON.stringify(this.get()),success:function(r,n,o){$(document).trigger("vertebrate:deleted",[e,e.attributes,r,n,o]),"function"==typeof t&&t.call(e,r,n,o)}});return r}},Vertebrate.Model.prototype=Object.create(Vertebrate.shared.fn),Vertebrate.Model.prototype.constructor=Vertebrate.Model,Vertebrate.Model.Extend=function(t){var e=function(e){Vertebrate.Model.call(this,t);var r=this,e="undefined"==typeof e?!1:e;return e&&(r.attributes=$.extend(r.attributes,e)),this};return e.prototype=Object.create(Vertebrate.Model.prototype),e.prototype.constructor=e,e},Vertebrate.Collection=function(t){Vertebrate.shared.fn.call(this,t),this.model=!1,this.models=[],this.added=[],this.removed=[];var e=this;$.each(t,function(t,r){"object"==typeof r?$.extend(e[t],r):e[t]=r}),this.save=function(t){var r=$.ajax({url:"undefined"==typeof this.url?Vertebrate.get("url"):this.url,method:"POST",data:{data:JSON.stringify([this.get(),this.models])},success:function(r,n,o){e.removed=[],"function"==typeof t&&t.call(e,r,n,o)}});return r},this.fetch=function(t){if(!e.model)return console.log("No model defined. Models must be defined before fetch call."),!1;var r=$.ajax({url:"undefined"==typeof this.url?Vertebrate.get("url"):this.url,method:"GET",dataType:"JSON",data:this.get(),success:function(r,n,o){e.models=[],$.each(r,function(t){e.models.push(new e.model(r[t]))}),e.removed=[],$(document).trigger("vertebrate:fetched",[e,e.models]),"function"==typeof t&&t.call(e,r,n,o)}});return r},this.find=function(t,r){var r="undefined"==typeof r?!1:r,n=!1;return r?($.each(e.models,function(e,o){return o.attributes[r]==t?(n=this,!1):void 0}),n?n:!1):e.models[t]},this.findAll=function(t,r){var n=!1,o=[];return $.each(e.models,function(e,i){i.attributes[r]==t&&(n=!0,o.push(this))}),n?o:!1},this.count=function(){return e.models.length},this.add=function(t){return e.added.push(t),e.models.push(t),$(document).trigger("vertebrate:added",[e,e.added,e.models]),e.models.length},this.remove=function(t){var r=e.models.filter(function(e){return e!=t});return e.models=r,e.removed.push(t),$(document).trigger("vertebrate:removed",[e,e.removed,e.models]),e.models.length},this.max=function(t){if("undefined"==typeof t)return!1;var r=0;return $.each(e.models,function(e,n){Number(n.attributes[t])>r&&(r=n.attributes[t])}),r},this.next=function(t){var r=e.max(t);return Number(r)+1}},Vertebrate.Collection.prototype=Object.create(Vertebrate.shared.fn),Vertebrate.Collection.prototype.constructor=Vertebrate.Collection,void(Vertebrate.Collection.Extend=function(t){function e(e){Vertebrate.Collection.call(this,t);var r=this;$.each(e,function(t,e){"object"==typeof e?$.extend(r[t],e):r[t]=e})}return e.prototype=Object.create(Vertebrate.Collection.prototype),e.prototype.constructor=e,e}))}();
